{% extends "base.html" %}
{% block title %}Domain Test Display{% endblock %}
{% block welcome %}{{ user }}{% endblock %}
{% block name %}{{ user }}{% endblock %}
{% block menu %}
    <ul class="sidebar-nav">
					<li class="sidebar-nav-link">
						<a href="{% url "index" %}">
							<i class="am-icon-home sidebar-nav-link-logo"></i> 首页
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url 'result_dis' %}" class="active">
							<i class="am-icon-clone sidebar-nav-link-logo"></i> 检测结果查看
							<span class="am-badge am-badge-secondary sidebar-nav-link-logo-ico am-round am-fr am-margin-right-sm"></span>
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "source_set" %}">
							<i class="am-icon-table sidebar-nav-link-logo"></i> 检测来源设置
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "testrule" %}">
							<i class="am-icon-calendar sidebar-nav-link-logo"></i> 检测规则设置
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "speed" %}" >
							<i class="am-icon-calendar sidebar-nav-link-logo"></i> 检测批数设置
						</a>
					</li>
                    <li class="sidebar-nav-link">
						<a href="{% url "resexport" %}" >
							<i class="am-icon-calendar sidebar-nav-link-logo"></i> 检测结果导出
						</a>
					</li>
                    <li class="sidebar-nav-heading"></li>
                    <li class="sidebar-nav-link">
                    </li>
			</div>
        </ul>
{% endblock %}
            {% block content %}
			<!-- 内容区域 -->

			<div class="tpl-content-wrapper">

				<div class="container-fluid am-cf">
					<div class="row">
						<div class="am-u-sm-12 am-u-md-12 am-u-lg-9">
							<div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span> 检测结果查看</div>
							<p class="page-header-description">目前只支持HTTP检测。</p>
						</div>
					</div>

				</div>

				<div class="row-content am-cf">

					<div class="row am-cf">
                        <div class="widget am-cf">
                                    <div style="margin-left: 10px;margin-bottom: 20px">
                                <div class="widget-title am-fl" style="margin-bottom: 20px"></div>
                            </div>


                               	<div style="height:700px;font-size: 20px" id="mainbaddata">
								</div>

                                </div>
                                <div class="widget am-cf">
                                    <div style="margin-left: 10px;margin-top: 20px">
                                <div class="widget-title am-fl">所有检验数据</div>
                            </div>
								<div style="margin-left: 10px;margin-top: 10px; height: 500px">

                               	<div style="height:500px;font-size: 20px" id="main">
								</div>
                                </div>
                                </div>


                    </div>
                </div>
			</div>
        {% endblock %}
{% block js %}
    $(document).ready(function () {
        getlocation();
        showchart();
    });
     function getlocation() {
        $.ajax({
                url: '{% url 'getba' %}',
                type: 'GET',
                success:function (callback) {
                    var callback_dict = $.parseJSON(callback);
                    console.log(callback_dict);
                    showpage(callback_dict.name, callback_dict.alldata, callback_dict.first, callback_dict.second, callback_dict.third);
                    }
                })

    };
     function showpage(name, alldata, first, second, third) {
            var myChart = echarts.init(document.getElementById('mainbaddata'));
            option = {
                backgroundColor: '#1b1b1b',
                color: [
                    'gold',
                    'rgba(14, 241, 242, 0.8)',
                    'rgba(37, 140, 249, 0.8)',
                    'yellowgreen'
                ],
                title: {
                    text: '已匹配域名的来源IP',
                    subtext: '数据以检验规则匹配的数量降序排列',
                    x: 'left',
                    y:'top',
                    textStyle: {
                        color: '#fff'
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}'
                },
                legend: {
                    orient: 'vertical',
                    x: 'left',
                    y:'center',
                    data: name,
                    selectedMode: 'single',
                    textStyle: {
                        color: '#fff'
                    }
                },
                series: [
                    {
                        name: name[2],
                        type: 'map',
                        mapType: 'world',
                        itemStyle: {
                            normal: {
                                borderColor: 'rgba(100,149,237,1)',
                                borderWidth: 1.5,
                                areaStyle: {color: '#1b1b1b'}
                            }
                        },
                        data: second
                    },
                    {
                        name: name[1],
                        type: 'map',
                        mapType: 'world',
                        data: first
                    },
                    {
                        name: name[0],
                        type: 'map',
                        mapType: 'world',
                        hoverable: false,
                        roam: true,
                        data: alldata
                    },
                    {
                        name: name[3],
                        type: 'map',
                        mapType: 'world',
                        data: third
                    },
                ]
            };
            window.onresize = myChart.resize;
            myChart.setOption(option);
        };
     function showchart() {
            $.ajax({
                url: '{% url 'getmonthdata' %}',
                type: 'GET',
                success:function (callback) {
                    var callback_dict = $.parseJSON(callback);
                    show(callback_dict.time, callback_dict.alldata_list, callback_dict.allbdata_list);
                    }
                })
            };
    function show(time, alldata, allbaddata) {
    var myChart = echarts.init(document.getElementById('main'));
        option = {
    tooltip : {
        trigger: 'axis'
    },
    legend: {
        data:[{name:'检测数据',textStyle:{color:'yellowgreen',fontSize:25}},{name:'异常数据',textStyle:{color:'yellowgreen',fontSize:25}}]
    },
    calculable : true,
    xAxis : [
        {
            axisLabel: {show: true,textStyle: {color: '#fff'}},
            type : 'category',
            boundaryGap : false,
            data : time
        }
    ],
    yAxis : [
        {
            axisLabel: {show: true,textStyle: {color: '#fff'}},
            type : 'value'
        }
    ],
    series : [
        {
            name:'检测数据',
            type:'line',
            stack: '总量',
            itemStyle : {
                    normal : {lineStyle:{color:'dodgerblue'}, areaStyle: {color:'dodgerblue'}}},
            data:alldata
        },
        {
            name:'异常数据',
            type:'line',
            stack: '总量',
            itemStyle : {
                    normal : {lineStyle:{color:'yellowgreen'}, areaStyle: {color:'yellowgreen'}}},
            data: allbaddata
        }
    ]
};
     myChart.setOption(option);
     window.onresize = myChart.resize;
         };
{% endblock %}

