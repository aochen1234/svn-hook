{% extends "base.html" %}
{% block title %}Webshell Index{% endblock %}
{% block welcome %}{{ user }}{% endblock %}
{% block name %}{{ user }}{% endblock %}
{% block menu %}
    <ul class="sidebar-nav">
					<li class="sidebar-nav-link">
						<a href="{% url "index" %}" class="active">
							<i class="am-icon-home sidebar-nav-link-logo"></i> 首页
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url 'result_dis' %}?catagory=result">
							<i class="am-icon-clone sidebar-nav-link-logo"></i> 检测结果查看
							<span class="am-badge am-badge-secondary sidebar-nav-link-logo-ico am-round am-fr am-margin-right-sm"></span>
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "test_source" %}">
							<i class="am-icon-table sidebar-nav-link-logo" style="color: #0c80ba"></i> 检测来源设置
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "testrule" %}">
							<i class="am-icon-calendar sidebar-nav-link-logo"></i> 检测规则设置
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "speed" %}" >
							<i class="am-icon-calendar sidebar-nav-link-logo"></i> 检测批数设置
						</a>
					</li>
                    <li class="sidebar-nav-heading"></li>
                    <li class="sidebar-nav-link">
                    </li>
			</div>
        </ul>
{% endblock %}
            {% block content %}
			<!-- 内容区域 -->

			<div class="tpl-content-wrapper">

				<div class="container-fluid am-cf">
					<div class="row">
						<div class="am-u-sm-12 am-u-md-12 am-u-lg-9">
							<div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span> 流量 <small>检测系统</small></div>
							<p class="page-header-description">目前只支持HTTP检测。</p>
						</div>
					</div>

				</div>

				<div class="row-content am-cf">
					<div class="row  am-cf">
						<div class="am-u-sm-12 am-u-md-12 am-u-lg-4">
							<div class="widget am-cf">
								<div class="widget-head am-cf">
									<div class="widget-title am-fl">本月累计检测数据</div>

								</div>
								<div class="widget-body am-fr">
									<div class="am-fl">
										<div class="widget-fluctuation-period-text">
                                            {{ all_data }}
											<a href="{% url "month" %}"><button class="widget-fluctuation-tpl-btn" type="submit">
                        <i class="am-icon-calendar"></i>
                        更多月份
                                            </button></a>
										</div>
									</div>
									<div class="am-fr am-cf">
										<div class="widget-fluctuation-description-amount am-text-danger" am-cf>
                                            <a href="{% url "result_dis" %}?catagory=allbaddata">{{ bad_data }}</a>
										</div>
										<div class="widget-fluctuation-description-text am-text-right">
											检测有害信息
										</div>
									</div>
								</div>
							</div>

						</div>
						<div class="am-u-sm-12 am-u-md-6 am-u-lg-4">
							<div class="widget widget-primary am-cf">
								<div class="widget-statistic-header">
									 待检测数据
								</div>
								<div class="widget-statistic-body">
									<div class="widget-statistic-value">
										{{ wait_check_data }}
									</div>
									<div class="widget-statistic-description">
										预计 {{ wait_time }} 内检测完成
									</div>
									<span class="widget-statistic-icon am-icon-credit-card-alt"></span>
								</div>
							</div>
						</div>
						<div class="am-u-sm-12 am-u-md-6 am-u-lg-4">
							<div class="widget widget-purple am-cf">
								<div class="widget-statistic-header">
									等待查看的结果
								</div>
								<div class="widget-statistic-body">
									<div class="widget-statistic-value">
                                        <a href="{% url "result_dis" %}?catagory=baddata">{{ wait_check_num }}</a>
									</div>
									<div class="widget-statistic-description">
										最后一条时间 <strong>{{ bad_data_time }}</strong>
									</div>
									<span class="widget-statistic-icon am-icon-support"></span>
								</div>
							</div>
						</div>
					</div>
					<div class="row am-cf">
                                <div class="widget am-cf">
								<div class="widget-head am-cf">
									<div class="widget-title am-fl">本月检测情况</div>
								</div>
                                <div  style="height:250px;font-size: 20px" id="main">
								</div>
                                </div>
					<div class="row am-cf">

						<div class="am-u-sm-12 am-u-md-12 am-u-lg-12 widget-margin-bottom-lg">

							<div class="widget am-cf widget-body-lg">

								<div class="widget-body  am-fr">
									<div class="am-scrollable-horizontal ">
										<table width="100%" class="am-table am-table-compact am-text-nowrap tpl-table-black " id="example-r">
											<thead>
												<tr>
													<th>检测时间</th>
													<th>检测ID</th>
                                                    <th>检测URL</th>
                                                    <th>检测COOKIE</th>
													<th>检测结果</th>
												</tr>
											</thead>
											<tbody>
                                            {% for re in result_list %}
                                                {% if re.is_target %}
                                                <tr class="gradeX" style="width:200px; height:50px;">
													<td>{{ re.created_at }} </td>
													<td>中国  {{ re.origin_id }} </td>
                                                    {% if re.origin_url == None  %}
                                                        <td>None</td>
                                                        {% else %}
                                                        <td>{{ re.origin_url | slice:"50" }}....</td>
                                                        {% endif %}
                                                {% if re.origin_cookie == None  %}
                                                        <td>None</td>
                                                        {% else %}
                                                    <td>{{ re.origin_cookie | slice:"50" }}....</td>
                                                        {% endif %}
													<td><span class="am-icon-close" style="color:crimson"></span></td>
												</tr>
                                            {% else %}
												<tr class="gradeX" style="width:200px; height:50px;">
													<td>{{ re.created_at }} </td>
													<td>中国  {{ re.origin_id }} </td>
                                                    {% if re.origin_url == None  %}
                                                        <td>None</td>
                                                        {% else %}
                                                        <td>{{ re.origin_url | slice:"50" }}....</td>
                                                        {% endif %}
                                                {% if re.origin_cookie == None  %}
                                                        <td>None</td>
                                                        {% else %}
                                                    <td>{{ re.origin_cookie | slice:"50" }}....</td>
                                                        {% endif %}
													<td><span class="am-icon-check" style="color:greenyellow"></span></td>
												</tr>
                                            {% endif %}
                                            {% endfor %}
												<!-- more data -->
											</tbody>
										</table>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
        {% endblock %}
     {% block js %}
         $(document).ready(function () {
                showchart();
            });
        function showchart() {
            $.ajax({
                url: '{% url 'getdata' %}',
                type: 'GET',
                success:function (callback) {
                    var callback_dict = $.parseJSON(callback);
                    show(callback_dict.time, callback_dict.alldata_list, callback_dict.baddata_list);
                    }
                })
            };
    function show(time, alldata, baddata) {
    var myChart = echarts.init(document.getElementById('main'));
        option = {
    tooltip : {
        trigger: 'axis'
    },
    toolbox: {
        show : true,
        feature : {
            mark : {show: true},
            dataView : {show: true, readOnly: false},
            magicType: {show: true, type: ['line', 'bar']},
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },
    calculable : true,
    legend: {
        data:[{name:'有害数据',textStyle:{color:'yellowgreen',fontSize:25}},{name:'检验数据总量',textStyle:{color:'yellowgreen',fontSize:25}}]
    },
    xAxis : [
        {
            type : 'category',
            axisLabel : {
                textStyle:{
                fontSize:25,
                color:'yellowgreen'
            }
            },
            data : time
        }
    ],
    yAxis : [
        {
            type : 'value',
            name : '数量',
            axisLabel : {
                formatter: '{value} 条',
            }
        },
        {
            type : 'value',
            name : '数量',
            axisLabel : {
                formatter: '{value} 条'
            }
        }
    ],
    series : [

        {
            name:'有害数据',
            type:'bar',
            itemStyle : {
                                normal : {
                                        color:'#0c80ba'
                                }
                            },
            data:baddata
        },
        {
            name:'检验数据总量',
            type:'line',
            yAxisIndex: 1,
            itemStyle : {
                                normal : {
                                    lineStyle:{
                                        color:'#00FF00'
                                    }
                                }
                            },
            data:alldata
        }
    ]
};


     myChart.setOption(option);
         }

     {% endblock %}

itemStyle : {
                                normal : {
                                    lineStyle:{
                                        color:'#00FF00'
                                    }
                                }
                            },
itemStyle : {
                                normal : {
                                        color:'#0c80ba'
                                }
                            },