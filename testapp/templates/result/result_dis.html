{% extends "base.html" %}
{% block title %}Webshell Test Display{% endblock %}
{% block welcome %}{{ user }}{% endblock %}
{% block name %}{{ user }}{% endblock %}
{% block menu %}
    <ul class="sidebar-nav">
					<li class="sidebar-nav-link">
						<a href="{% url "index" %}">
							<i class="am-icon-home sidebar-nav-link-logo"></i> 首页
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url 'result_dis' %}" class="active">
							<i class="am-icon-clone sidebar-nav-link-logo"></i> 检测结果查看
							<span class="am-badge am-badge-secondary sidebar-nav-link-logo-ico am-round am-fr am-margin-right-sm"></span>
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "test_source" %}">
							<i class="am-icon-table sidebar-nav-link-logo" style="color: #0c80ba"></i> 检测来源设置
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "testrule" %}">
							<i class="am-icon-calendar sidebar-nav-link-logo"></i> 检测规则设置
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="{% url "speed" %}" >
							<i class="am-icon-calendar sidebar-nav-link-logo"></i> 检测批数设置
						</a>
					</li>
                    <li class="sidebar-nav-heading"></li>
                    <li class="sidebar-nav-link">
                    </li>
			</div>
        </ul>
{% endblock %}
            {% block content %}
			<!-- 内容区域 -->

			<div class="tpl-content-wrapper">

				<div class="container-fluid am-cf">
					<div class="row">
						<div class="am-u-sm-12 am-u-md-12 am-u-lg-9">
                            <div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span> 检验结果展示 <small>共<strong style="color: yellowgreen;font-size: larger">{{ result }}</strong>条数据</small></div>
							<p class="page-header-description">目前只支持HTTP检测。</p>
						</div>
                        <div class="page-header-heading" >快速查询</div>
                        <div class="am-fl tpl-header-search" style="margin-right: 200px;">
						<form class="tpl-header-search-form" action="{% url "search_action" cata %}" method="post">
                            {% csrf_token %}
                            <select style="margin-left: 1150px;height: 30px"  id="select" onchange="getvalues();" name="myselect">
                                        <option value="1" name="page">页数</option>
                                        <option value="2" name="month">年月</option>
                                        <option value="3" name="origin_id">原始ID</option>
                                        <option value="4" name="test_name">检验名字</option>
                                        <option value="5" name="target">已匹配</option>
                                      </select>
                            <input  type="text"  placeholder="搜索内容..." style="width: 150px;height: 30px;border: 1px solid yellowgreen" name="stuff">
                            <button class="tpl-header-search-btn am-icon-search" type="submit"></button>
                            {% if errors %}
                            <div class="page-header-heading" style="color: yellowgreen;font-size: medium;margin-left: 1200px" id="caption">{{ errors }}</div>
                                {% endif %}
						</form>
                          <div class="page-header-heading" style="color: yellowgreen;font-size: medium;margin-left: 1280px" id="caption"></div>
					</div>
					</div>


				</div>


                <div class="row  am-cf">
							<div class="widget am-cf widget-body-lg">

								<div class="widget-body  am-fr">
									<div class="am-scrollable-horizontal ">
										<table width="200%" class="am-table am-table-compact am-text-nowrap tpl-table-black " id="example-r">
											<thead>
												<tr>
													<th style="font-size: 20px">检测时间</th>
													<th style="font-size: 20px">原始ID</th>
                                                    <th style="font-size: 20px">原始URL</th>
                                                    <th style="font-size: 20px">原始COOKIE</th>
													<th style="font-size: 20px">检测结果</th>
                                                    <th style="font-size: 20px">匹配规则</th>
												</tr>
											</thead>
											<tbody>
                                            {% for re in users.object_list %}
                                                {% if re.is_target %}
                                                <tr class="gradeX" style="width:200px; height:50px;">
													<td>{{ re.created_at }} </td>
													<td>中国  {{ re.origin_id }} </td>
                                                    {% if re.origin_url == None  %}
                                                        <td>None</td>
                                                        {% else %}
                                                        <td><a href="{% url "all_data" re.id %}">{{ re.origin_url | slice:"50" }}....</a></td>
                                                        {% endif %}
                                                {% if re.origin_cookie == None  %}
                                                        <td>None</td>
                                                        {% else %}
                                                    <td>{{ re.origin_cookie | slice:"50" }}....</td>
                                                        {% endif %}
													<td><span class="am-icon-close" style="color:crimson"></span></td>
                                                    <td>{{ re.testrule.name }} </td>
												</tr>
                                            {% else %}
												<tr class="gradeX" style="width:200px; height:60px;">
													<td>{{ re.created_at }} </td>
													<td>中国  {{ re.origin_id }} </td>
                                                    {% if re.origin_url == None  %}
                                                        <td>None</td>
                                                        {% else %}
                                                    <td>{{ re.origin_url | slice:"50" }}....</td>
                                                        {% endif %}
                                                {% if re.origin_cookie == None  %}
                                                        <td>None</td>
                                                        {% else %}
                                                    <td>{{ re.origin_cookie | slice:"50" }}....</td>
                                                        {% endif %}
													<td><span class="am-icon-check" style="color:greenyellow"></span></td>
												</tr>
                                            {% endif %}
                                            {% endfor %}
												<!-- more data -->
											</tbody>
										</table>
                                    <nav aria-label="Page navigation" style="margin-left: 1000px">
                                            <ul class="pagination">
                                                {% if users.has_previous %}
                                                    <li>
                                                    <a class="type-vale" href="?page={{ users.previous_page_number }}&type={{ type }}&sort={{ sort }}&catas={{ cata }}" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
                                                    </li>
                                                {% endif %}

                                               {% for pg in users.paginator.pager_num_range %}
                                                {% if pg == users.number %}
                                                <li class="active"><a class="type-vale" href="?page={{ pg }}&type={{ type }}&sort={{ sort }}&catas={{ cata }}">{{ pg }}</a></li>
                                                {% else %}
                                                <li><a class="type-vale" href="?page={{ pg }}&type={{ type }}&sort={{ sort }}&catas={{ cata }}">{{ pg }}</a></li>
                                                {% endif %}
                                                {% endfor %}
                                                {% if users.has_next %}
                                                    <li>
                                                        <a class="type-vale" href="?page={{ users.next_page_number }}&type={{ type }}&sort={{ sort }}&catas={{ cata }}" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
                                                {% endif %}
                                                    <span style="font-size: 20px;margin-left: 30px">{{ users.number }} /{{ users.paginator.num_pages }}</span>
                                            </ul>
                                            </nav>
                                    </div>
								</div>
							</div>

						</div>
					</div>
        {% endblock %}
{% block js %}
    function getvalues() {
    var opt = $('#select option:selected').val();
    if ( opt == '1'){
        $('#caption').text('请输入大于0的整数');}
    else if ( opt == '2') {
        $('#caption').text('请输入正确的年月，从201707开始');}
    else if ( opt == '3') {
        $('#caption').text('请输入正确的原始ID，如：8812');}
    else if ( opt == '4') {
        $('#caption').text('请输入正确的检验名字，如：C99');}
    else if ( opt == '5') {
        $('#caption').text('请直接提交');}
    }
{% endblock %}
{% block other %}<script>
            $first=$.cookie('first_vist');
            if(!$first||$first=='null'||$first==null){
                $.cookie('first_vist','1',{ expires: 7 });
            }else{
                $.cookie('first_vist',null);
                location.reload(true);
            }
</script>{% endblock %}
